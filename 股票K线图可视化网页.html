<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨Kçº¿å›¾åˆ†æå·¥å…·</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .controls {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }
        
        .stock-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .stock-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .stock-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .stock-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .chart-container {
            padding: 20px;
            height: 600px;
        }
        
        #kline-chart {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .data-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .data-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .data-card h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .up { color: #2ecc71; }
        .down { color: #e74c3c; }
        
        .footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: #ecf0f1;
        }
        
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .indicator-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 400px;
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                padding: 15px;
            }
            
            .stock-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ è‚¡ç¥¨Kçº¿å›¾åˆ†æå·¥å…·</h1>
            <p class="subtitle">ä¸“ä¸šçº§è‚¡ç¥¨æ•°æ®å¯è§†åŒ– - æ”¯æŒå¤šå‘¨æœŸKçº¿ã€æŠ€æœ¯æŒ‡æ ‡ä¸å®æ—¶æ•°æ®</p>
        </div>
        
        <div class="controls">
            <div class="stock-selector">
                <div class="stock-btn active" data-code="0700.HK">è…¾è®¯æ§è‚¡</div>
                <div class="stock-btn" data-code="AAPL">è‹¹æœå…¬å¸</div>
                <div class="stock-btn" data-code="MSFT">å¾®è½¯</div>
                <div class="stock-btn" data-code="TSLA">ç‰¹æ–¯æ‹‰</div>
                <div class="stock-btn" data-code="BABA">é˜¿é‡Œå·´å·´</div>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨åŠ è½½è‚¡ç¥¨æ•°æ®...</p>
        </div>
        
        <div class="chart-container">
            <div id="kline-chart"></div>
        </div>
        
        <div class="data-panel">
            <div class="data-card">
                <h3>ğŸ“Š ä»Šæ—¥è¡Œæƒ…</h3>
                <div class="data-row">
                    <span>å½“å‰ä»·æ ¼:</span>
                    <span class="value" id="current-price">--</span>
                </div>
                <div class="data-row">
                    <span>æ¶¨è·Œå¹…:</span>
                    <span class="value" id="change-percent">--</span>
                </div>
                <div class="data-row">
                    <span>å¼€ç›˜ä»·:</span>
                    <span class="value" id="open-price">--</span>
                </div>
                <div class="data-row">
                    <span>æœ€é«˜ä»·:</span>
                    <span class="value" id="high-price">--</span>
                </div>
                <div class="data-row">
                    <span>æœ€ä½ä»·:</span>
                    <span class="value" id="low-price">--</span>
                </div>
                <div class="data-row">
                    <span>æˆäº¤é‡:</span>
                    <span class="value" id="volume">--</span>
                </div>
            </div>
            
            <div class="data-card">
                <h3>ğŸ“ˆ æŠ€æœ¯æŒ‡æ ‡</h3>
                <div class="indicator-grid">
                    <div class="indicator-item">
                        <div>MA5</div>
                        <div class="value" id="ma5">--</div>
                    </div>
                    <div class="indicator-item">
                        <div>MA10</div>
                        <div class="value" id="ma10">--</div>
                    </div>
                    <div class="indicator-item">
                        <div>MA20</div>
                        <div class="value" id="ma20">--</div>
                    </div>
                    <div class="indicator-item">
                        <div>RSI</div>
                        <div class="value" id="rsi">--</div>
                    </div>
                </div>
            </div>
            
            <div class="data-card">
                <h3>ğŸ“‹ æ•°æ®ç»Ÿè®¡</h3>
                <div class="data-row">
                    <span>æ•°æ®å‘¨æœŸ:</span>
                    <span class="value" id="period">--</span>
                </div>
                <div class="data-row">
                    <span>æ•°æ®ç‚¹æ•°:</span>
                    <span class="value" id="data-points">--</span>
                </div>
                <div class="data-row">
                    <span>å¹³å‡æˆäº¤é‡:</span>
                    <span class="value" id="avg-volume">--</span>
                </div>
                <div class="data-row">
                    <span>æ³¢åŠ¨ç‡:</span>
                    <span class="value" id="volatility">--</span>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© BTR è‚¡ç¥¨Kçº¿å›¾åˆ†æå·¥å…· | æ•°æ®ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®</p>
            <p>æœ€åæ›´æ–°: <span id="update-time">--</span></p>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–EChartså®ä¾‹
        let chartInstance = null;
        
        // è‚¡ç¥¨æ•°æ®æ˜ å°„
        const stockData = {
            '0700.HK': { name: 'è…¾è®¯æ§è‚¡', basePrice: 320 },
            'AAPL': { name: 'è‹¹æœå…¬å¸', basePrice: 150 },
            'MSFT': { name: 'å¾®è½¯', basePrice: 300 },
            'TSLA': { name: 'ç‰¹æ–¯æ‹‰', basePrice: 200 },
            'BABA': { name: 'é˜¿é‡Œå·´å·´', basePrice: 80 }
        };
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        // éšè—åŠ è½½åŠ¨ç”»
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // ç”Ÿæˆæ¨¡æ‹Ÿè‚¡ç¥¨æ•°æ®
        function generateStockData(code, days = 150) {
            const basePrice = stockData[code].basePrice;
            const volatility = 0.02; // 2% æ—¥æ³¢åŠ¨ç‡
            
            let data = [];
            let currentPrice = basePrice;
            const startDate = new Date();
            startDate.setDate(startDate.getDate() - days);
            
            for (let i = 0; i < days; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                
                // è·³è¿‡å‘¨æœ«
                if (date.getDay() === 0 || date.getDay() === 6) continue;
                
                // æ¨¡æ‹Ÿä»·æ ¼æ³¢åŠ¨ï¼ˆå‡ ä½•å¸ƒæœ—è¿åŠ¨ï¼‰
                const change = (Math.random() - 0.5) * 2 * volatility;
                const open = currentPrice;
                const close = open * (1 + change);
                const high = Math.max(open, close) * (1 + Math.random() * 0.01);
                const low = Math.min(open, close) * (1 - Math.random() * 0.01);
                const volume = Math.floor(Math.random() * 10000000) + 1000000;
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    timestamp: date.getTime(),
                    open: parseFloat(open.toFixed(2)),
                    close: parseFloat(close.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    volume: volume
                });
                
                currentPrice = close;
            }
            
            return data;
        }
        
        // è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
        function calculateIndicators(data) {
            const closes = data.map(d => d.close);
            const volumes = data.map(d => d.volume);
            
            // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
            const ma5 = calculateMA(closes, 5);
            const ma10 = calculateMA(closes, 10);
            const ma20 = calculateMA(closes, 20);
            
            // è®¡ç®—RSI
            const rsi = calculateRSI(closes, 14);
            
            return { ma5, ma10, ma20, rsi };
        }
        
        // è®¡ç®—ç§»åŠ¨å¹³å‡çº¿
        function calculateMA(data, period) {
            const result = [];
            for (let i = 0; i < data.length; i++) {
                if (i < period - 1) {
                    result.push('-');
                    continue;
                }
                let sum = 0;
                for (let j = 0; j < period; j++) {
                    sum += data[i - j];
                }
                result.push((sum / period).toFixed(2));
            }
            return result;
        }
        
        // è®¡ç®—RSI
        function calculateRSI(closes, period = 14) {
            if (closes.length < period) return Array(closes.length).fill('-');
            
            const gains = [];
            const losses = [];
            
            for (let i = 1; i < closes.length; i++) {
                const change = closes[i] - closes[i - 1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? Math.abs(change) : 0);
            }
            
            const rsi = Array(period).fill('-');
            
            for (let i = period; i < gains.length; i++) {
                let avgGain = 0;
                let avgLoss = 0;
                
                for (let j = 0; j < period; j++) {
                    avgGain += gains[i - period + j];
                    avgLoss += losses[i - period + j];
                }
                
                avgGain /= period;
                avgLoss /= period;
                
                if (avgLoss === 0) {
                    rsi.push(100);
                } else {
                    const rs = avgGain / avgLoss;
                    rsi.push((100 - (100 / (1 + rs))).toFixed(2));
                }
            }
            
            return rsi;
        }
        
        // æ›´æ–°Kçº¿å›¾
        function updateChart(code) {
            showLoading();
            
            setTimeout(() => {
                const rawData = generateStockData(code);
                const indicators = calculateIndicators(rawData);
                
                // å‡†å¤‡å›¾è¡¨æ•°æ®
                const dates = rawData.map(item => item.date);
                const values = rawData.map((item, index) => [
                    item.open,
                    item.close,
                    item.low,
                    item.high,
                    item.volume,
                    indicators.ma5[index] !== '-' ? indicators.ma5[index] : null,
                    indicators.ma10[index] !== '-' ? indicators.ma10[index] : null,
                    indicators.ma20[index] !== '-' ? indicators.ma20[index] : null
                ]);
                
                // é…ç½®å›¾è¡¨é€‰é¡¹
                const option = {
                    backgroundColor: '#ffffff',
                    animation: true,
                    legend: {
                        top: 10,
                        data: [stockData[code].name, 'MA5', 'MA10', 'MA20', 'æˆäº¤é‡']
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        },
                        borderWidth: 1,
                        borderColor: '#ccc',
                        padding: 10,
                        textStyle: {
                            color: '#000'
                        },
                        formatter: function (params) {
                            const data = params[0].data;
                            const date = params[0].axisValue;
                            
                            let result = `<div style="font-size:14px;margin-bottom:5px;font-weight:bold">${date}</div>`;
                            result += `<div>å¼€ç›˜: ${data[0]}</div>`;
                            result += `<div>æ”¶ç›˜: ${data[1]}</div>`;
                            result += `<div>æœ€ä½: ${data[2]}</div>`;
                            result += `<div>æœ€é«˜: ${data[3]}</div>`;
                            result += `<div>æˆäº¤é‡: ${data[4].toLocaleString()}</div>`;
                            
                            return result;
                        }
                    },
                    grid: [
                        {
                            left: '10%',
                            right: '8%',
                            height: '60%'
                        },
                        {
                            left: '10%',
                            right: '8%',
                            top: '73%',
                            height: '16%'
                        }
                    ],
                    xAxis: [
                        {
                            type: 'category',
                            data: dates,
                            boundaryGap: false,
                            axisLine: { onZero: false },
                            splitLine: { show: false },
                            min: 'dataMin',
                            max: 'dataMax'
                        },
                        {
                            type: 'category',
                            gridIndex: 1,
                            data: dates,
                            boundaryGap: false,
                            axisLine: { onZero: false },
                            axisTick: { show: false },
                            splitLine: { show: false },
                            axisLabel: { show: false },
                            min: 'dataMin',
                            max: 'dataMax'
                        }
                    ],
                    yAxis: [
                        {
                            scale: true,
                            splitArea: {
                                show: true
                            }
                        },
                        {
                            scale: true,
                            gridIndex: 1,
                            splitNumber: 2,
                            axisLabel: { show: false },
                            axisLine: { show: false },
                            axisTick: { show: false },
                            splitLine: { show: false }
                        }
                    ],
                    dataZoom: [
                        {
                            type: 'inside',
                            xAxisIndex: [0, 1],
                            start: 70,
                            end: 100
                        },
                        {
                            show: true,
                            xAxisIndex: [0, 1],
                            type: 'slider',
                            top: '90%',
                            start: 70,
                            end: 100
                        }
                    ],
                    series: [
                        {
                            name: stockData[code].name,
                            type: 'candlestick',
                            data: values.map(item => [item[0], item[1], item[2], item[3]]),
                            itemStyle: {
                                color: '#ef232a',
                                color0: '#14b143',
                                borderColor: '#ef232a',
                                borderColor0: '#14b143'
                            }
                        },
                        {
                            name: 'MA5',
                            type: 'line',
                            data: values.map(item => item[5]),
                            smooth: true,
                            lineStyle: {
                                width: 2,
                                color: '#crimson'
                            },
                            symbol: 'none'
                        },
                        {
                            name: 'MA10',
                            type: 'line',
                            data: values.map(item => item[6]),
                            smooth: true,
                            lineStyle: {
                                width: 2,
                                color: 'gold'
                            },
                            symbol: 'none'
                        },
                        {
                            name: 'MA20',
                            type: 'line',
                            data: values.map(item => item[7]),
                            smooth: true,
                            lineStyle: {
                                width: 2,
                                color: 'black'
                            },
                            symbol: 'none'
                        },
                        {
                            name: 'æˆäº¤é‡',
                            type: 'bar',
                            xAxisIndex: 1,
                            yAxisIndex: 1,
                            data: values.map(item => item[4]),
                            itemStyle: {
                                color: function(params) {
                                    const data = values[params.dataIndex];
                                    return data[1] >= data[0] ? '#ef232a' : '#14b143';
                                }
                            }
                        }
                    ]
                };
                
                // åˆå§‹åŒ–æˆ–æ›´æ–°å›¾è¡¨
                if (!chartInstance) {
                    chartInstance = echarts.init(document.getElementById('kline-chart'));
                }
                
                chartInstance.setOption(option);
                hideLoading();
                
                // æ›´æ–°æ•°æ®é¢æ¿
                updateDataPanel(rawData, indicators, code);
            }, 800);
        }
        
        // æ›´æ–°æ•°æ®é¢æ¿
        function updateDataPanel(rawData, indicators, code) {
            const latest = rawData[rawData.length - 1];
            const prev = rawData[rawData.length - 2] || latest;
            
            const changePercent = ((latest.close - prev.close) / prev.close * 100).toFixed(2);
            const changeClass = changePercent >= 0 ? 'up' : 'down';
            
            // æ›´æ–°ä»Šæ—¥è¡Œæƒ…
            document.getElementById('current-price').textContent = latest.close.toFixed(2);
            document.getElementById('change-percent').innerHTML = 
                `<span class="${changeClass}">${changePercent}%</span>`;
            document.getElementById('open-price').textContent = latest.open.toFixed(2);
            document.getElementById('high-price').textContent = latest.high.toFixed(2);
            document.getElementById('low-price').textContent = latest.low.toFixed(2);
            document.getElementById('volume').textContent = latest.volume.toLocaleString();
            
            // æ›´æ–°æŠ€æœ¯æŒ‡æ ‡
            document.getElementById('ma5').textContent = indicators.ma5[indicators.ma5.length - 1] || '-';
            document.getElementById('ma10').textContent = indicators.ma10[indicators.ma10.length - 1] || '-';
            document.getElementById('ma20').textContent = indicators.ma20[indicators.ma20.length - 1] || '-';
            document.getElementById('rsi').textContent = indicators.rsi[indicators.rsi.length - 1] || '-';
            
            // æ›´æ–°æ•°æ®ç»Ÿè®¡
            const firstDate = new Date(rawData[0].date);
            const lastDate = new Date(rawData[rawData.length - 1].date);
            document.getElementById('period').textContent = 
                `${firstDate.toLocaleDateString()} - ${lastDate.toLocaleDateString()}`;
            document.getElementById('data-points').textContent = rawData.length;
            
            const volumes = rawData.map(item => item.volume);
            const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
            document.getElementById('avg-volume').textContent = avgVolume.toLocaleString('en-US', {maximumFractionDigits: 0});
            
            const prices = rawData.map(item => item.close);
            const volatility = calculateVolatility(prices);
            document.getElementById('volatility').textContent = `${volatility.toFixed(2)}%`;
            
            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            document.getElementById('update-time').textContent = new Date().toLocaleString();
        }
        
        // è®¡ç®—æ³¢åŠ¨ç‡
        function calculateVolatility(prices) {
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                returns.push((prices[i] - prices[i-1]) / prices[i-1]);
            }
            
            const avgReturn = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((a, b) => a + Math.pow(b - avgReturn, 2), 0) / returns.length;
            
            return Math.sqrt(variance * 252) * 100;
        }
        
        // è‚¡ç¥¨åˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.stock-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.stock-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const code = this.getAttribute('data-code');
                updateChart(code);
            });
        });
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨
        window.addEventListener('resize', function() {
            if (chartInstance) {
                chartInstance.resize();
            }
        });
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å›¾è¡¨
        document.addEventListener('DOMContentLoaded', function() {
            updateChart('0700.HK');
        });
    </script>
</body>
</html>
