name: 股票分析自动化

on:
  schedule:
    # 每天UTC时间10:00运行（北京时间18:00）
    - cron: '0 10 * * *'
  workflow_dispatch:  # 允许手动触发
  push:
    branches: [ main, master ]

jobs:
  stock-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: 检出代码
      uses: actions/checkout@v4
      
    - name: 设置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install yfinance akshare pandas numpy matplotlib
        
    - name: 运行股票分析
      run: |
        python stock_analysis_github.py
        
    - name: 上传分析结果
      uses: actions/upload-artifact@v4
      with:
        name: stock-analysis-results
        path: |
          stock_chart_*.png
        retention-days: 7
        
    - name: 生成分析报告
      run: |
        echo "# 股票分析报告" > report.md
        echo "生成时间: $(date)" >> report.md
        echo "## 分析结果" >> report.md
        echo "![AAPL图表](stock_chart_AAPL_1.png)" >> report.md
        echo "![000001图表](stock_chart_000001_2.png)" >> report.md
        
    - name: 上传报告
      uses: actions/upload-artifact@v4
      with:
        name: analysis-report
        path: report.md
